<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FieldFlow — Well Status</title>
<style>
  :root{--bg:#0f172a;--panel:#0b1222;--ink:#e5e7eb;--muted:#94a3b8;--line:rgba(255,255,255,.12);--accent:#38bdf8;--r:14px;--shadow:0 10px 30px rgba(0,0,0,.35)}
  *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--ink);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial}
  header{padding:18px;text-align:center;border-bottom:1px solid var(--line);background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.01))}
  h1{margin:6px 0 2px;font-size:22px}.muted{color:var(--muted);font-size:13px}
  main{max-width:1080px;margin:18px auto 80px;padding:0 14px}
  .card{background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));border:1px solid var(--line);border-radius:var(--r);padding:14px;box-shadow:var(--shadow);margin-bottom:12px}
  label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
  select,input,textarea{background:#0a0f1f;border:1px solid var(--line);color:var(--ink);border-radius:10px;padding:8px 10px;font-size:14px;width:100%}
  .row{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
  @media(max-width:900px){.row{grid-template-columns:1fr 1fr}}
  @media(max-width:560px){.row{grid-template-columns:1fr}}
  .acc{border:1px solid var(--line);border-radius:12px;overflow:hidden;background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));box-shadow:var(--shadow);margin-bottom:8px}
  .acc-h{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;background:rgba(255,255,255,.04);cursor:pointer}
  .acc-b{display:none;padding:12px;background:rgba(0,0,0,.25)}
  .open .acc-b{display:block}
  .buttons{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
  button{background:linear-gradient(180deg,rgba(56,189,248,.25),rgba(56,189,248,.12));border:1px solid rgba(56,189,248,.5);color:white;border-radius:10px;padding:10px 14px;cursor:pointer;font-weight:700}
  button.secondary{background:transparent;border:1px solid var(--line);color:var(--ink)}
  .home{position:fixed;right:16px;bottom:16px}
  .muter{color:var(--muted);font-size:12px}
</style>
</head>
<body>
<header>
  <h1>Well Status</h1>
  <div class="muted">Set status for each well • Save as one combined file</div>
</header>

<main>
  <div class="card">
    <div class="row">
      <div>
        <label>Well Type</label>
        <select id="wellType"><option value="production" selected>Production</option><option value="obs">OBS</option></select>
      </div>
      <div>
        <label>Field</label>
        <select id="fieldSel"></select>
      </div>
      <div>
        <label>Date</label>
        <input id="dateInput" type="text" readonly/>
      </div>
      <div>
        <label>Attendant</label>
        <select id="attendant"><option>T. Cherry</option><option>T. Ressler</option></select>
      </div>
    </div>
    <div class="buttons" style="margin-top:10px">
      <button id="expandAll" type="button">Expand All</button>
      <button id="collapseAll" class="secondary" type="button">Collapse All</button>
      <button id="saveAll" type="button">Save All Visible (Combined)</button>
    </div>
  </div>

  <div id="wellsContainer"></div>

  <a class="home" href="index.html"><button class="secondary">← Home</button></a>
</main>

<script>
/* Wells (same lists as Annuals) */
const productionWells = {
  "Dixon": ["Evans 7","Evans 8","Evans 3","Evans 10","Evans 5","Evans 4-H","Evans 6","Cory 8","Cory 4","Cory 2","Cory 7","Cory 3","Cory 6","Cory 5","Cory 1"],
  "Simpson Chapel": ["Blaker 1","Emery 2","Emery 1","Crays 8","Crays 5","Crays 4","Crays 3","Crays 7","Crays 2","Crays 6","Royal 6","Royal 5","Royal 4","Royal 7","Royal 1"],
  "Mineral City": ["Rollison 4","Rollison 1","Rollison 2","G. Axe 6","Haines 4","Haines 1","Haines 2","Haines 3","G. Axe 1","Allen 1","G. Axe 2","G. Axe 4","G. Axe 5","G. Axe 3","J. Axe 1"]
};
const obsWells = {
  "Dixon": ["Evans 1","Evans 2","Evans 9","Hendren 1","Mount 1","Dowden 1"],
  "Mineral City": ["Horning 1","G Axe 7","Boruff 1","Floyd 1","Rollison 5","Foster 1"],
  "Simpson Chapel": ["Blackmore 3","RH Stone 1","Royal 2","Royal 3","Rollison 5","Royal 9","S Blackmore 1","Blackmore 4","Royal 8"]
};
const STATUS_OPTS = ["OK","Monitor","Leak","Repair","Shut In","Down"];

const $ = s => document.querySelector(s);
const el=(t,a={},c=[])=>{const n=document.createElement(t);Object.entries(a).forEach(([k,v])=>k.startsWith("on")?n.addEventListener(k.slice(2),v):n.setAttribute(k,v));c.forEach(x=>n.appendChild(typeof x==="string"?document.createTextNode(x):x));return n;};
const todayStr=()=>{const d=new Date(),p=n=>String(n).padStart(2,"0");return `${d.getFullYear()}-${p(d.getMonth()+1)}-${p(d.getDate())}`;};
const uid=(p="WS")=>`${p}-${Date.now()}-${Math.random().toString(36).slice(2,8)}`;

let currentType="production", currentField="Dixon";

function init(){
  $("#dateInput").value=todayStr();
  buildFieldSelect(); renderWells();
  $("#wellType").addEventListener("change", e=>{ currentType=e.target.value; buildFieldSelect(); renderWells(); });
  $("#fieldSel").addEventListener("change", e=>{ currentField=e.target.value; renderWells(); });
  $("#expandAll").addEventListener("click", ()=>setAll(true));
  $("#collapseAll").addEventListener("click", ()=>setAll(false));
  $("#saveAll").addEventListener("click", saveBatch);
}

function buildFieldSelect(){
  const fs=$("#fieldSel"); fs.innerHTML="";
  const list = currentType==="production" ? Object.keys(productionWells) : Object.keys(obsWells);
  list.forEach((f,i)=>{ fs.appendChild(new Option(f,f)); if(i===0) currentField=f; });
  fs.value=currentField;
}

function renderWells(){
  const cont=$("#wellsContainer"); cont.innerHTML="";
  const wells = (currentType==="production"? productionWells: obsWells)[currentField] || [];
  wells.forEach(well=>{
    cont.appendChild(buildWellAcc(currentField, well));
  });
}

function buildWellAcc(field, well){
  const id=`${currentType}-${field}-${well}`.replace(/\s+/g,"_");
  const acc=el("div",{class:"acc"});
  const head=el("div",{class:"acc-h",onClick:()=>acc.classList.toggle("open")},[
    el("div",{},[el("strong",{},[well])," ",el("span",{class:"muter"},[`(${field})`])]),
    el("span",{class:"muter"},["Status: ", el("span",{id:`statusTxt-${id}`},["OK"])])
  ]);
  const body=el("div",{class:"acc-b"},[
    groupSelect(`status-${id}`,"Status", STATUS_OPTS, "OK", ()=>{$(`#statusTxt-${id}`).textContent=$(`#status-${id}`).value;}),
    groupText(`notes-${id}`,"Notes (optional)")
  ]);
  acc.appendChild(head); acc.appendChild(body);
  return acc;
}

function groupSelect(id,label,opts,def,onchange){
  const s=el("select",{id,onchange},opts.map(o=>el("option",{selected:o===def?true:undefined},[o])));
  return el("div",{},[el("label",{},[label]), s]);
}
function groupText(id,label){ return el("div",{},[el("label",{},[label]), el("textarea",{id,rows:"3"})]); }
function setAll(open){ document.querySelectorAll(".acc").forEach(a=>a.classList.toggle("open", open)); }

function collectOne(field, well, id){
  return {
    recordType:"Well Status",
    wellType: currentType==="production" ? "Production" : "OBS",
    field, well,
    date: $("#dateInput").value,
    attendant: $("#attendant").value,
    status: $("#status-"+id).value,
    notes: $("#notes-"+id).value,
    savedAt: new Date().toISOString()
  };
}

function saveBatch(){
  const cont=$("#wellsContainer");
  const entries=[];
  cont.querySelectorAll(".acc").forEach(acc=>{
    const well = acc.querySelector("strong")?.textContent?.trim() || "Unknown";
    const id = `${currentType}-${currentField}-${well}`.replace(/\s+/g,"_");
    entries.push(collectOne(currentField, well, id));
  });
  if(!entries.length){ alert("No wells found."); return; }
  const key="wellStatusBatches";
  const arr=JSON.parse(localStorage.getItem(key)||"[]");
  arr.push({
    recordType:"Well Status",
    batch:true,
    batchId: uid(),
    wellType: entries[0]?.wellType || "",
    field: entries[0]?.field || currentField,
    date: $("#dateInput").value,
    attendant: $("#attendant").value,
    count: entries.length,
    entries,
    savedAt: new Date().toISOString()
  });
  localStorage.setItem(key, JSON.stringify(arr));
  toast(`Saved ${entries.length} wells as one combined file`);
}

function toast(msg){
  let t=document.getElementById("toast");
  if(!t){t=el("div",{id:"toast",style:"position:fixed;left:50%;transform:translateX(-50%);bottom:18px;background:rgba(34,197,94,.15);border:1px solid rgba(34,197,94,.5);padding:10px 14px;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,.35);font-weight:700;backdropFilter:"+"blur(6px);zIndex:9999"},[msg]);document.body.appendChild(t);}else t.textContent=msg;
  t.style.opacity="1"; setTimeout(()=>{t.style.transition="opacity .6s"; t.style.opacity="0";},1200);
}
document.addEventListener("DOMContentLoaded", init);
</script>
</body>
</html>
