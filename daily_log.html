<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Daily Pressure Log</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 10px;
      background: #f4f4f4;
    }
    h2, h3 {
      text-align: center;
    }
    select, input, button {
      margin: 4px;
      padding: 5px;
    }
    .well-block {
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 12px;
      background: white;
    }
    .status {
      font-weight: bold;
    }
    .green { color: green; }
    .yellow { color: goldenrod; }
    .red { color: red; }
  </style>
</head>
<body>

  <h2>Daily Pressure Log</h2>

  <label for="fieldSelect">Select Field:</label>
  <select id="fieldSelect" onchange="loadWells()">
    <option value="">-- Select --</option>
    <option value="Simpson Chapel">Simpson Chapel</option>
    <option value="Mineral City">Mineral City</option>
    <option value="Dixon">Dixon</option>
  </select>

  <br><br>

  <label for="targetMCF">Daily MCF Target:</label>
  <input type="number" id="targetMCF" placeholder="Enter target MCF" />

  <h3>Total MCF: <span id="totalMCF">0</span></h3>

  <div id="wellsContainer"></div>

  <button onclick="goHome()">Home</button>

  <script>
    const fieldWells = {
      "Simpson Chapel": ["Well SC1", "Well SC2", "Well SC3"],
      "Mineral City": ["Well MC1", "Well MC2"],
      "Dixon": ["Well D1", "Well D2", "Well D3"]
    };

    const defaultOrificeSize = 1.0;
    const flowConstant = 24.22; // example constant for 1-inch orifice

    function loadWells() {
      const field = document.getElementById("fieldSelect").value;
      const wells = fieldWells[field] || [];
      const container = document.getElementById("wellsContainer");
      container.innerHTML = "";

      wells.forEach(well => {
        const block = document.createElement("div");
        block.className = "well-block";
        block.innerHTML = `
          <h4>${well}</h4>
          Time: <input type="time" value="${getCurrentTime()}" /><br>
          Orifice Size: <input type="number" value="${defaultOrificeSize}" step="0.01" readonly /><br>
          Upstream Pressure: <input type="number" onchange="recalculate()" class="up" placeholder="psi" /><br>
          Downstream Pressure: <input type="number" onchange="recalculate()" class="down" placeholder="psi" /><br>
          Differential Pressure: <input type="number" class="diff" readonly /><br>
          MCF/hour: <input type="number" class="mcf" readonly /><br>
          Status: <span class="status">-</span><br>
          Notes: <input type="text" /><br>
        `;
        container.appendChild(block);
      });
    }

    function recalculate() {
      let total = 0;
      const target = parseFloat(document.getElementById("targetMCF").value || 0);
      const blocks = document.querySelectorAll(".well-block");

      blocks.forEach(block => {
        const up = parseFloat(block.querySelector(".up").value || 0);
        const down = parseFloat(block.querySelector(".down").value || 0);
        const diffInput = block.querySelector(".diff");
        const mcfInput = block.querySelector(".mcf");
        const statusSpan = block.querySelector(".status");

        const diff = Math.max(up - down, 0);
        const mcf = Math.round(flowConstant * Math.sqrt(diff) * 100) / 100;

        diffInput.value = diff.toFixed(2);
        mcfInput.value = isNaN(mcf) ? "" : mcf;
        total += isNaN(mcf) ? 0 : mcf;

        if (!target) {
          statusSpan.innerHTML = "-";
          statusSpan.className = "status";
        } else {
          const perWellTarget = target / blocks.length;
          if (mcf >= perWellTarget * 0.95) {
            statusSpan.innerHTML = "On Track";
            statusSpan.className = "status green";
          } else if (mcf >= perWellTarget * 0.7) {
            statusSpan.innerHTML = "Below Target";
            statusSpan.className = "status yellow";
          } else {
            statusSpan.innerHTML = "Too Low";
            statusSpan.className = "status red";
          }
        }
      });

      document.getElementById("totalMCF").innerText = total.toFixed(2);
    }

    function getCurrentTime() {
      const now = new Date();
      return now.toTimeString().slice(0,5);
    }

    function goHome() {
      window.location.href = "index.html";
    }
  </script>
</body>
</html>
