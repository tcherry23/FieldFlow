<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Annual Inspection History</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f0f0f0;
    }
    h2 {
      text-align: center;
    }
    select {
      padding: 8px;
      margin: 10px 0;
    }
    .accordion {
      background-color: #fff;
      margin-bottom: 10px;
      border-radius: 6px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    .accordion-header {
      background-color: #007BFF;
      color: white;
      padding: 15px;
      cursor: pointer;
      font-weight: bold;
    }
    .accordion-content {
      display: none;
      padding: 15px;
      background-color: #fff;
      border-top: 1px solid #ddd;
    }
    .accordion-content p {
      margin: 5px 0;
    }
    button {
      margin-top: 15px;
      padding: 8px 16px;
      background: #28a745;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background: #218838;
    }
  </style>
</head>
<body>

<h2>Annual Inspection Log History</h2>

<label for="fieldSelect">Select Field:</label>
<select id="fieldSelect">
  <option value="Dixon">Dixon</option>
  <option value="Simpson Chapel">Simpson Chapel</option>
  <option value="Mineral City">Mineral City</option>
</select>

<label for="wellSelect">Select Well:</label>
<select id="wellSelect">
  <!-- Populated by JS -->
</select>

<div id="historyContainer"></div>

<script>
  const inspections = JSON.parse(localStorage.getItem('annualInspections')) || [];

  const fields = {
    "Dixon": ["Evans 10", "Evans 5", "Evan 4-H", "Cory 8", "Cory 4", "Cory 2", "Cory 7", "Cory 3", "Cory 6", "Cory 5", "Cory 1"],
    "Simpson Chapel": ["Blaker 1", "Emery 2", "Emery 1", "Crays 8", "Crays 5", "Crays 4", "Crays 3", "Crays 7", "Crays 2", "Crays 6", "Royal 6", "Royal 5", "Royal 4", "Royal 7", "Royal 1"],
    "Mineral City": ["Haines 1", "Haines 2", "Haines 3", "Haines 4", "G. Axe 1", "G. Axe 2", "G. Axe 3", "G. Axe 4", "G. Axe 5", "G. Axe 6", "J. Axe 1", "Rollison 1", "Rollison 2", "Rollison 3", "Rollison 4", "Headley 1"]
  };

  const fieldSelect = document.getElementById('fieldSelect');
  const wellSelect = document.getElementById('wellSelect');
  const historyContainer = document.getElementById('historyContainer');

  function populateWells() {
    const field = fieldSelect.value;
    wellSelect.innerHTML = '';
    fields[field].forEach(well => {
      const option = document.createElement('option');
      option.value = well;
      option.textContent = well;
      wellSelect.appendChild(option);
    });
    renderHistory();
  }

  function renderHistory() {
    const selectedField = fieldSelect.value;
    const selectedWell = wellSelect.value;

    const filtered = inspections.filter(entry =>
      entry.field === selectedField && entry.well === selectedWell
    );

    historyContainer.innerHTML = '';

    if (filtered.length === 0) {
      historyContainer.innerHTML = '<p>No saved inspections for this well.</p>';
      return;
    }

    filtered.forEach((entry, index) => {
      const accordion = document.createElement('div');
      accordion.className = 'accordion';

      const header = document.createElement('div');
      header.className = 'accordion-header';
      header.textContent = `${entry.date} — ${entry.field} / ${entry.well}`;
      header.onclick = () => {
        const content = accordion.querySelector('.accordion-content');
        content.style.display = content.style.display === 'block' ? 'none' : 'block';
      };

      const content = document.createElement('div');
      content.className = 'accordion-content';
      content.innerHTML = `
        <p><strong>Upstream:</strong> ${entry.upstream || ''}</p>
        <p><strong>Downstream:</strong> ${entry.downstream || ''}</p>
        <p><strong>Field Pressure:</strong> ${entry.fieldPressure || ''}</p>
        <p><strong>Valve Check:</strong> ${entry.valveCheck ? 'Yes' : 'No'}</p>
        <p><strong>Leak Check:</strong> ${entry.leakCheck ? 'Yes' : 'No'}</p>
        ${entry.leakType ? `<p><strong>Leak Type:</strong> ${entry.leakType}</p>` : ''}
        <p><strong>Notes:</strong> ${entry.notes || ''}</p>
        <button onclick="printEntry(${index})">Print Entry</button>
      `;

      accordion.appendChild(header);
      accordion.appendChild(content);
      historyContainer.appendChild(accordion);
    });
  }

  function printEntry(index) {
    const entry = inspections[index];
    const printWindow = window.open('', '', 'height=600,width=800');
    printWindow.document.write('<html><head><title>Inspection Log</title></head><body>');
    printWindow.document.write(`<h2>${entry.field} – ${entry.well} (${entry.date})</h2>`);
    printWindow.document.write(`<p><strong>Upstream:</strong> ${entry.upstream || ''}</p>`);
    printWindow.document.write(`<p><strong>Downstream:</strong> ${entry.downstream || ''}</p>`);
    printWindow.document.write(`<p><strong>Field Pressure:</strong> ${entry.fieldPressure || ''}</p>`);
    printWindow.document.write(`<p><strong>Valve Check:</strong> ${entry.valveCheck ? 'Yes' : 'No'}</p>`);
    printWindow.document.write(`<p><strong>Leak Check:</strong> ${entry.leakCheck ? 'Yes' : 'No'}</p>`);
    if (entry.leakType) {
      printWindow.document.write(`<p><strong>Leak Type:</strong> ${entry.leakType}</p>`);
    }
    printWindow.document.write(`<p><strong>Notes:</strong> ${entry.notes || ''}</p>`);
    printWindow.document.write('</body></html>');
    printWindow.document.close();
    printWindow.print();
  }

  fieldSelect.addEventListener('change', populateWells);
  wellSelect.addEventListener('change', renderHistory);

  populateWells(); // initial population
</script>

</body>
</html>
