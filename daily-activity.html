<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>FieldFlow – Daily Activity Log</title>
<style>
  :root{--ink:#e5e7eb;--muted:#9ca3af;--pri:#0B5FFF}
  html,body{margin:0;background:#0b1220;color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
  header{padding:18px 16px;background:linear-gradient(180deg,#0B5FFF22,#0000)}
  .brand{display:flex;justify-content:space-between;align-items:center;gap:12px}
  h1{margin:0;font-size:20px}
  .tag{color:#9ca3af;margin-top:6px}
  .wrap{max-width:1100px;margin:0 auto;padding:0 14px 28px}
  .card{background:#111827;border:1px solid #1f2937;border-radius:12px;padding:14px;margin-top:14px}
  .grid{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:10px}
  label{font-size:12px;color:var(--muted);display:flex;flex-direction:column;gap:6px}
  input,select,textarea{background:#0b1220;border:1px solid #1f2937;color:var(--ink);border-radius:8px;padding:10px 12px;font-size:14px;outline:none}
  textarea{min-height:72px;resize:vertical}
  input:focus,select:focus,textarea:focus{border-color:var(--pri)}
  table{width:100%;border-collapse:collapse}
  th,td{border:1px solid #1f2937;padding:8px 6px;font-size:13px;vertical-align:top}
  th{background:#0f1627;color:#cdd7ff;text-align:left}
  .time{width:82px;white-space:nowrap;color:#cbd5e1;background:#0f1627}
  .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
  button{background:#0B5FFF;border:none;color:#fff;padding:10px 14px;border-radius:8px;cursor:pointer}
  button.secondary{background:#0b1220;border:1px solid #1f2937}
  button.warn{background:#b91c1c}
  footer{border-top:1px solid #1f2937;padding:18px 16px;color:#9ca3af;font-size:12px}
  footer .footwrap{max-width:1100px;margin:0 auto;display:flex;justify-content:space-between;align-items:center}
  a.link{color:#9fb2ff;text-decoration:none}
</style>
</head>
<body>
<header>
  <div class="brand">
    <div>
      <h1>FieldFlow</h1>
      <div class="tag">Daily Activity Log • Area 2402</div>
    </div>
    <div>
      <button class="secondary" onclick="resetDay(true)">Reset Autosave</button>
    </div>
  </div>
</header>

<div class="wrap">
  <div class="card">
    <div class="grid">
      <label>Employee
        <select id="employee">
          <option value="T. Cherry">T. Cherry</option>
          <option value="T. Ressler">T. Ressler</option>
          <option>Operator A</option>
          <option>Operator B</option>
        </select>
      </label>
      <label>Date <input type="date" id="date"></label>
      <label>Clock # (optional) <input id="clock" type="text" placeholder="—"></label>
      <label>Location (overall day, optional) <input id="dayLoc" type="text" placeholder="e.g., Dixon/Mineral/Shop"></label>
    </div>
  </div>

  <div class="card" style="overflow:auto">
    <table id="tbl">
      <thead>
        <tr><th class="time">AM</th><th>Job Description</th><th>Location</th></tr>
      </thead>
      <tbody id="body">
        <!-- rows injected -->
      </tbody>
    </table>
    <div class="actions">
      <button id="exportCsv" class="secondary">Export CSV</button>
      <label class="secondary" style="padding:9px 12px;border-radius:8px;cursor:pointer">
        Import CSV<input type="file" id="importCsv" accept=".csv" style="display:none">
      </label>
      <button id="print" class="secondary">Print</button>
      <button class="warn" onclick="resetDay()">Clear Day</button>
    </div>
  </div>

  <div class="card">
    <div class="grid">
      <label class="full">Remarks
        <textarea id="remarks" placeholder="Notes for the day…"></textarea>
      </label>
      <label>Signature <input id="sign" placeholder="Type name for now (draw pad later)"></label>
      <div></div><div></div>
    </div>
  </div>
</div>

<footer>
  <div class="footwrap">
    <div>© 2025 FieldFlow | Underground Gas Storage</div>
    <a class="link" href="terms.html">Terms of Use</a>
  </div>
</footer>

<script>
const KEY = 'ff_daily_activity_autosave_v1';
const SLOTS = [
  // label, meridiem shown like the paper
  ["7:00","AM"],["7:30",""],["8:00",""],["8:30",""],["9:00",""],["9:30",""],
  ["10:00",""],["10:30",""],["11:00",""],["11:30",""],
  ["12:00","PM"],["12:30",""],["1:00",""],["1:30",""],["2:00",""],["2:30",""],["3:00",""]
];

const $ = id => document.getElementById(id);
const body = $('body'); // tbody
const dateEl = $('date');

function init(){
  // date
  const n = new Date();
  dateEl.value = n.toISOString().slice(0,10);

  // build table rows like the paper
  const tb = $('body'); tb.innerHTML='';
  SLOTS.forEach((s,i)=>{
    const tr = document.createElement('tr');
    const ampm = s[1];
    tr.innerHTML = `
      <td class="time">${ampm?ampm+" ":""}${s[0]}</td>
      <td><textarea rows="2" data-field="job" data-slot="${i}" placeholder="What did you do?"></textarea></td>
      <td><input data-field="loc" data-slot="${i}" placeholder="Where?"></td>`;
    tb.appendChild(tr);
  });

  // listeners for autosave
  document.querySelectorAll('input, textarea, select').forEach(el=>{
    el.addEventListener('input', save);
    el.addEventListener('change', save);
  });

  // import/export/print
  $('exportCsv').addEventListener('click', doExport);
  $('importCsv').addEventListener('change', doImport);
  $('print').addEventListener('click', ()=>window.print());

  // restore autosave
  restore();
}
init();

/* Autosave */
function collect(){
  const data = {
    employee: $('employee').value,
    date: $('date').value,
    clock: $('clock').value,
    dayLoc: $('dayLoc').value,
    rows: SLOTS.map((_,i)=>({
      job: val(`[data-field="job"][data-slot="${i}"]`),
      loc: val(`[data-field="loc"][data-slot="${i}"]`)
    })),
    remarks: $('remarks').value,
    sign: $('sign').value
  };
  return data;
}
function fill(data){
  $('employee').value=data.employee||'T. Cherry';
  $('date').value=data.date||$('date').value;
  $('clock').value=data.clock||'';
  $('dayLoc').value=data.dayLoc||'';
  (data.rows||[]).forEach((r,i)=>{
    sel(`[data-field="job"][data-slot="${i}"]`).value=r.job||'';
    sel(`[data-field="loc"][data-slot="${i}"]`).value=r.loc||'';
  });
  $('remarks').value=data.remarks||'';
  $('sign').value=data.sign||'';
}
function save(){
  localStorage.setItem(KEY, JSON.stringify(collect()));
}
function restore(){
  try{
    const raw = localStorage.getItem(KEY);
    if(!raw) return;
    const data = JSON.parse(raw);
    if(data && typeof data==='object'){ fill(data); }
  }catch(e){}
}
function resetDay(confirmNeeded){
  if(confirmNeeded && !confirm('Clear all entries and autosave?')) return;
  localStorage.removeItem(KEY);
  init();
}

/* CSV IO */
function doExport(){
  const d = collect();
  const headers = ["Date","Employee","Clock","Day Location","Slot","Time","Job Description","Location","Remarks","Signature"];
  const rows = [];
  SLOTS.forEach((s,i)=>{
    rows.push([
      d.date, d.employee, d.clock, d.dayLoc,
      i+1, s[0], (d.rows[i]?.job||''), (d.rows[i]?.loc||''), d.remarks, d.sign
    ]);
  });
  const csv = [headers, ...rows]
    .map(cols=>cols.map(v=>`"${String(v??"").replace(/"/g,'""')}"`).join(','))
    .join('\n');
  download(csv, `Daily_Activity_${d.date}.csv`);
}
function doImport(evt){
  const f=evt.target.files?.[0]; if(!f) return;
  const r=new FileReader();
  r.onload=()=>{ try{
      const text=r.result;
      const lines=text.split(/\r?\n/).filter(l=>l.trim().length);
      if(lines.length<2) return;
      const cells = line=>parseCSV(line);
      const meta = cells(lines[1]); // first data row
      const data = {employee: meta[1], date: meta[0], clock: meta[2], dayLoc: meta[3], rows: [], remarks:'', sign:''};
      for(let i=1;i<lines.length;i++){
        const c = cells(lines[i]); if(c.length<10) continue;
        const slotIndex = (+c[4]||1)-1;
        data.rows[slotIndex] = {job:c[6]||'', loc:c[7]||''};
        data.remarks = c[8]||data.remarks;
        data.sign = c[9]||data.sign;
      }
      fill(data); save();
      evt.target.value='';
      alert('Imported.');
    }catch(e){ alert('Could not import CSV.'); }
  };
  r.readAsText(f);
}
function parseCSV(line){
  const out=[];let cur='';let q=false;
  for(let i=0;i<line.length;i++){
    const ch=line[i],nx=line[i+1];
    if(ch=='"'&&q&&nx=='"'){cur+='"';i++;continue;}
    if(ch=='"'){q=!q;continue;}
    if(ch==','&&!q){out.push(cur);cur='';continue;}
    cur+=ch;
  } out.push(cur); return out;
}
function download(text, name){
  const a=document.createElement('a');
  a.href=URL.createObjectURL(new Blob([text],{type:'text/csv;charset=utf-8;'}));
  a.download=name; a.click();
}

/* helpers */
function val(selr){ const el=document.querySelector(selr); return el?el.value:''; }
function sel(selr){ return document.querySelector(selr); }
</script>
</body>
</html>
